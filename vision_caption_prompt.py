
"""
vision_caption_prompt.py

保育園向けの画像解析用プロンプトを返すモジュール。

Vision モデルに対して、
- caption（1文の説明）
- tags（特徴タグの配列）
- scores（0〜1のスコア）
- has_child / num_children / main_subject（子どもに関する情報）
- bbox（主な子どものバウンディングボックス）

を JSON 形式で返すように指示します。
"""


def build_vision_caption_prompt() -> str:
    """
    Vision モデルに渡すプロンプト文字列を返す。

    画像を入力として、以下のような JSON オブジェクトのみを出力させることを想定しています:

    {
      "caption": "室内で男の子がブロックで遊んでいる。",
      "tags": ["室内", "ブロック", "笑顔", "子ども"],
      "scores": {"cuteness": 0.9, "representative": 0.8},
      "has_child": true,
      "num_children": 1,
      "main_subject": "男の子",
      "bbox": [0.35, 0.40, 0.50, 0.80]
    }

    bbox は画像全体を幅 1.0, 高さ 1.0 としたときの
    [x_min, y_min, x_max, y_max] で、0〜1 範囲の浮動小数とする。
    """
    prompt = (
        "あなたは保育園で撮影された写真を解析するアシスタントです。"
        "以下の画像を見て、次の情報を日本語で JSON 形式で出力してください。\n\n"
        "【必ず含める項目】\n"
        "- caption: 画像の内容を1文で説明してください。\n"
        "  例: \"室内で男の子がブロックで遊んでいる。\"\n"
        "- tags: 画像の特徴を表す短いタグの配列を返してください。\n"
        "  例: [\"室内\", \"ブロック\", \"笑顔\", \"子ども\"]\n"
        "- scores: 次のキーを含む 0〜1 のスコアを返してください。\n"
        "  - cuteness: 写真の「可愛さ」\n"
        "  - representative: その日全体を代表しているかどうか\n"
        "  必要に応じて他のスコアを追加しても構いません。\n"
        "- has_child: 子どもが1人以上写っている場合は true、そうでなければ false。\n"
        "- num_children: 写っている子どもの人数の推定値（0以上の整数）。\n"
        "- main_subject: 主な被写体を短く表してください。\n"
        "  例: \"男の子\", \"女の子\", \"先生\", \"保護者\", \"複数の子ども\" など。\n"
        "- bbox: 主な子ども1人のバウンディングボックスを、\n"
        "  画像全体を幅1.0, 高さ1.0としたときの [x_min, y_min, x_max, y_max] で返してください。\n"
        "  例えば、左上が [0.1, 0.2]、右下が [0.4, 0.7] のように 0〜1 の範囲の小数で返します。\n\n"
        "【重要なフォーマット指定】\n"
        "- 出力は必ず JSON オブジェクト1つだけにしてください。\n"
        "- 説明文やコメントなど、JSON 以外の文字は一切書かないでください。\n"
        "- JSON のキーは必ず以下を含めてください:\n"
        "  caption, tags, scores, has_child, num_children, main_subject, bbox\n"
    )
    return prompt
