
"""
vision_caption_prompt.py

保育園向けの画像解析用プロンプトを返すモジュール。

Vision モデルに対して、
- caption（1文の説明）
- tags（特徴のタグ配列）
- scores（0〜1のスコア）
- has_child / num_children / main_subject（子どもに関する情報）
- bbox（主な子どものバウンディングボックス）

を JSON 形式で返すように指示します。
"""


def build_vision_caption_prompt() -> str:
    """
    Vision モデルに渡すプロンプト文字列を返す。
    """
    prompt = (
        "あなたは保育園で撮影された写真を解析する専門家です。"
        "以下の画像を注意深く観察し、指定された形式でJSONオブジェクトのみを出力してください。\n\n"

        "【出力形式】\n"
        "以下のJSON構造を厳密に守ってください。説明文やコメントは一切含めないでください。\n\n"

        "{\n"
        '  "caption": "画像の内容を1文で簡潔に説明してください。主語と述語を明確にし、具体的な行動や状況を含めてください。",\n'
        '  "tags": ["タグ1", "タグ2", "タグ3"],\n'
        '  "scores": {\n'
        '    "cuteness": 0.0-1.0,\n'
        '    "interesting": 0.0-1.0,\n'
        '    "representative": 0.0-1.0\n'
        "  },\n"
        '  "has_child": true/false,\n'
        '  "num_children": 0以上の整数,\n'
        '  "main_subject": "主な被写体（例: 男の子、女の子、先生、複数の子どもなど）",\n'
        '  "bbox": [x_min, y_min, x_max, y_max]\n'
        "}\n\n"

        "【各項目の詳細説明】\n"
        "1. caption: 画像に写っている内容を1文で説明。誰が、どこで、何をしているかを明確に。\n"
        "   例: \"室内の保育室で、男の子がブロックで遊んでいる。\"\n"
        "   例: \"屋外の園庭で、複数の子どもが滑り台で遊んでいる。\"\n\n"

        "2. tags: 画像の特徴を表す短いタグを配列で。以下のカテゴリから関連するものを選んでください。\n"
        "   - 場所: 室内、屋外、保育室、園庭、廊下、トイレ、給食室など\n"
        "   - 活動: 遊び、食事、お昼寝、制作、運動、読み聞かせなど\n"
        "   - 対象: 子ども、先生、保護者、おもちゃ、絵本など\n"
        "   - 感情・表情: 笑顔、泣いている、集中、楽しそうなど\n"
        "   例: [\"室内\", \"ブロック\", \"笑顔\", \"男の子\", \"遊び\"]\n\n"

        "3. scores: 各スコアは0.0から1.0の間の浮動小数点数で評価してください。\n"
        "   - cuteness: 写真の「可愛さ」や「愛らしさ」の度合い\n"
        "   - interesting: 写真の「興味深さ」や「印象的さ」の度合い\n"
        "   - representative: その日の活動全体を代表しているかどうか\n\n"

        "4. has_child: 子どもが1人以上写っている場合はtrue、写っていない場合はfalse。\n\n"

        "5. num_children: 写っている子どもの人数を推定してください。0以上の整数で。\n\n"

        "6. main_subject: 主な被写体を短く表してください。\n"
        "   例: \"男の子\", \"女の子\", \"先生\", \"保護者\", \"複数の子ども\" など\n\n"

        "7. bbox: 主な子ども1人の位置をバウンディングボックスで指定してください。\n"
        "   画像全体を幅1.0、高さ1.0としたときの正規化座標で [x_min, y_min, x_max, y_max] の形式。\n"
        "   子どもが写っていない場合は [0.0, 0.0, 0.0, 0.0] を返してください。\n\n"

        "【重要な注意事項】\n"
        "- 出力は必ずJSONオブジェクト1つだけにしてください。\n"
        "- JSONの前後に説明文、コメント、マークダウン記号（```jsonなど）は一切付けないでください。\n"
        "- すべてのキー（caption, tags, scores, has_child, num_children, main_subject, bbox）を含めてください。\n"
        "- JSONの構文エラーがないよう、ダブルクォート、カンマ、括弧を正確に使用してください。\n"
        "- 数値は浮動小数点数または整数として正しく記述してください。\n"
    )
    return prompt
